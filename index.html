<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>طلب صيانة المركبات </title>
  <style>
    body {
      font-family: 'Tahoma', sans-serif;
      background-color: #f4f6fa;
      margin: 0;
      padding: 20px;
      color: #333;
    }

    h1 {
      text-align: center;
      color: #003366;
      margin-bottom: 30px;
    }

    .form-section, .invoice-section {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }

    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
    }

    button {
      background-color: #003366;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      margin-top: 15px;
      padding: 12px;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #004080;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
    }

    .col {
      flex: 1;
      min-width: 200px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 16px;
    }

    table th, table td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: center;
    }

    table th {
      background-color: #003366;
      color: white;
      font-weight: bold;
    }

    table tr:nth-child(even) {
      background-color: #f2f2f2;
    }

    .logo-preview {
      height: 60px;
      margin-top: 10px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    #printArea {
      display: none;
    }

    .pagination {
      display: flex;
      justify-content: center;
      margin: 20px 0;
    }

    .pagination button {
      width: auto;
      padding: 8px 15px;
      margin: 0 5px;
    }

    .login-container {
      max-width: 400px;
      margin: 50px auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .login-title {
      text-align: center;
      color: #003366;
      margin-bottom: 20px;
    }

    .alert {
      padding: 15px;
      margin-bottom: 20px;
      border: 1px solid transparent;
      border-radius: 4px;
      text-align: center;
    }

    .alert-danger {
      color: #721c24;
      background-color: #f8d7da;
      border-color: #f5c6cb;
    }

    .hidden {
      display: none;
    }

    .datalist-input {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
    }

    @media print {
      body {
        visibility: hidden;
        margin: 0;
        padding: 0;
      }

      #printArea {
        display: block !important;
        visibility: visible;
        width: 100%;
        height: auto;
        position: absolute;
        top: 0;
        right: 0;
        padding: 20px;
        background: white;
      }

      @page {
        size: A4 landscape;
        margin: 15mm;
      }

      .print-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        border-bottom: 2px solid #003366;
        padding-bottom: 10px;
      }

      .print-title {
        text-align: center;
        color: #003366;
        margin: 0;
        font-size: 24px;
        flex-grow: 1;
      }

      .print-logo {
        height: 70px;
      }

      .print-date {
        text-align: left;
        font-size: 14px;
        color: #666;
      }

      .print-table {
        width: 100%;
        margin-top: 20px;
        border-collapse: collapse;
      }

      .print-table th {
        background-color: #003366 !important;
        color: white !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
        padding: 10px;
        border: 1px solid #ddd;
      }

      .print-table td {
        padding: 10px;
        border: 1px solid #ddd;
      }

      .no-print {
        display: none !important;
      }
    }
  </style>
</head>
<body>

  <!-- نظام تسجيل الدخول -->
  <div id="loginSection" class="login-container">
    <h2 class="login-title">نظام إدارة المركبات - الزهراني</h2>
    <div id="loginError" class="alert alert-danger hidden">
      تحاول الدخول لنظام إدارة المركبات - الزهراني<br>اسم المستخدم أو كلمة المرور غير صحيحة!
    </div>
    <form id="loginForm">
      <label for="username">اسم المستخدم:</label>
      <input type="text" id="username" placeholder="أدخل اسم المستخدم" required>
      
      <label for="password">كلمة المرور:</label>
      <input type="password" id="password" placeholder="أدخل كلمة المرور" required>
      
      <button type="button" onclick="login()">تسجيل الدخول</button>
    </form>
  </div>

  <!-- نظام إدارة المركبات -->
  <div id="mainContent" class="hidden">
    <h1>طلب صيانة المركبات (تم بالفعل)</h1>

    <div class="form-section">
      <div class="row">
        <div class="col">
          <label>الخدمة:</label>
          <input type="text" id="service" placeholder="أدخل نوع الخدمة">
        </div>
        <div class="col">
          <label>رقم اللوحة:</label>
          <input type="text" id="plate" placeholder="أدخل رقم اللوحة">
        </div>
        <div class="col">
          <label>المنطقة:</label>
          <input list="regions" id="region" class="datalist-input" placeholder="اكتب أو اختر المنطقة">
          <datalist id="regions">
            <option value="الرياض">
            <option value="جدة">
            <option value="مكة المكرمة">
            <option value="المدينة المنورة">
            <option value="الدمام">
            <option value="الخبر">
            <option value="الظهران">
            <option value="بريدة">
            <option value="تبوك">
            <option value="الطائف">
            <option value="حائل">
            <option value="أبها">
            <option value="نجران">
            <option value="جازان">
            <option value="سكاكا">
            <option value="عرعر">
            <option value="القريات">
            <option value="النعيرية">
            <option value="رفحاء">
            <option value="ضباء">
            <option value="الليث">
            <option value="القنفذة">
            <option value="بيشة">
            <option value="محايل عسير">
            <option value="خميس مشيط">
            <option value="الخرج">
            <option value="الدوادمي">
            <option value="وادي الدواسر">
            <option value="الأحساء">
            <option value="حفر الباطن">
            <option value="القطيف">
            <option value="ينبع">
            <option value="العلا">
            <option value="رابغ">
            <option value="الباحة">
            <option value="الزلفي">
            <option value="الرس">
            <option value="عنيزة">
            <option value="المجمعة">
            <option value="الخفجي">
            <option value="طريف">
            <option value="الدرب">
            <option value="صبيا">
            <option value="أحد رفيدة">
            <option value="بلجرشي">
            <option value="المهد">
            <option value="الوجه">
            <option value="أملج">
            <option value="بدر">
            <option value="الحريق">
            <option value="حوطة بني تميم">
            <option value="الغاط">
            <option value="السليل">
            <option value="ضرما">
            <option value="المزاحمية">
          </datalist>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <label>تاريخ الطلب:</label>
          <input type="date" id="date">
        </div>
        <div class="col">
          <label>المسافة المقطوعة (كم):</label>
          <input type="number" id="distance" placeholder="أدخل المسافة بالكيلومترات">
        </div>
        <div class="col">
          <label>اختيار الشعار:</label>
          <select id="logoSelect">
            <option value="https://i.imgur.com/8SUC13Y.png">الزهراني</option>
            <option value="https://i.imgur.com/yS26oQZ.png">ميم</option>
          </select>
          <img id="logoPreview" class="logo-preview" src="https://i.imgur.com/8SUC13Y.png" alt="شعار الشركة">
        </div>
      </div>
      <button onclick="addInvoice()">إضافة الفاتورة</button>
    </div>

    <div class="invoice-section">
      <div class="row">
        <div class="col">
          <label>اختيار اللوحات للطباعة:</label>
          <select id="plateSelect" multiple size="5" style="height: 120px; width: 100%;"></select>
        </div>
        <div class="col" style="display: flex; align-items: flex-end;">
          <button onclick="printSelected()" style="width: 100%;">طباعة PDF</button>
        </div>
      </div>

      <div class="pagination">
        <button onclick="prevPage()">«</button>
        <button onclick="prevPage()">< السابق</button>
        <span style="padding: 8px 15px; margin: 0 5px;">1 من 2</span>
        <button onclick="nextPage()">التالي ></button>
        <button onclick="nextPage()">»</button>
      </div>

      <table id="invoiceTable">
        <thead>
          <tr>
            <th>الخدمة</th>
            <th>رقم اللوحة</th>
            <th>المنطقة</th>
            <th>تاريخ الطلب</th>
            <th>المسافة (كم)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="printArea"></div>
  </div>

  <script>
    const data = [];
    let currentPage = 1;
    const itemsPerPage = 5;
    let loggedIn = false;
    let regionsList = [
      "الرياض", "جدة", "مكة المكرمة", "المدينة المنورة", "الدمام", 
      "الخبر", "الظهران", "بريدة", "تبوك", "الطائف", 
      "حائل", "أبها", "نجران", "جازان", "سكاكا", 
      "عرعر", "القريات", "النعيرية", "رفحاء", "ضباء", 
      "الليث", "القنفذة", "بيشة", "محايل عسير", "خميس مشيط", 
      "الخرج", "الدوادمي", "وادي الدواسر", "الأحساء", "حفر الباطن", 
      "القطيف", "ينبع", "العلا", "رابغ", "الباحة", 
      "الزلفي", "الرس", "عنيزة", "المجمعة", "الخفجي", 
      "طريف", "الدرب", "صبيا", "أحد رفيدة", "بلجرشي", 
      "المهد", "الوجه", "أملج", "بدر", "الحريق", 
      "حوطة بني تميم", "الغاط", "السليل", "ضرما", "المزاحمية"
    ];

    // نظام تسجيل الدخول
    function login() {
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;
      
      if (username === "مشرف" && password === "00") {
        document.getElementById("loginError").classList.add("hidden");
        document.getElementById("loginSection").classList.add("hidden");
        document.getElementById("mainContent").classList.remove("hidden");
        loggedIn = true;
      } else {
        document.getElementById("loginError").classList.remove("hidden");
      }
    }

    // إذا كان المستخدم يحاول الوصول مباشرة للصفحة الرئيسية دون تسجيل دخول
    if (!loggedIn) {
      document.getElementById("loginSection").classList.remove("hidden");
      document.getElementById("mainContent").classList.add("hidden");
    }

    document.getElementById("logoSelect").addEventListener("change", function () {
      document.getElementById("logoPreview").src = this.value;
    });

    function addInvoice() {
      if (!loggedIn) {
        alert("يجب تسجيل الدخول أولاً");
        return;
      }

      const service = document.getElementById("service").value.trim();
      const plate = document.getElementById("plate").value.trim();
      const region = document.getElementById("region").value.trim();
      const date = document.getElementById("date").value;
      const distance = document.getElementById("distance").value.trim();

      if (!service || !plate || !region || !date || !distance) {
        alert("يرجى تعبئة جميع الحقول.");
        return;
      }

      // إذا كانت المنطقة جديدة نضيفها للقائمة
      if (!regionsList.includes(region)) {
        regionsList.push(region);
        updateRegionsDatalist();
      }

      const record = { service, plate, region, date, distance };
      data.push(record);

      updateTable();
      updatePlateSelect();

      // Reset inputs
      document.getElementById("service").value = "";
      document.getElementById("plate").value = "";
      document.getElementById("region").value = "";
      document.getElementById("date").value = "";
      document.getElementById("distance").value = "";
    }

    function updateRegionsDatalist() {
      const datalist = document.getElementById("regions");
      datalist.innerHTML = "";
      
      regionsList.forEach(region => {
        const option = document.createElement("option");
        option.value = region;
        datalist.appendChild(option);
      });
    }

    function updateTable() {
      const tbody = document.querySelector("#invoiceTable tbody");
      tbody.innerHTML = "";

      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const paginatedData = data.slice(start, end);

      paginatedData.forEach(item => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${item.service}</td>
          <td>${item.plate}</td>
          <td>${item.region}</td>
          <td>${item.date}</td>
          <td>${parseFloat(item.distance).toFixed(2)}</td>
        `;
        tbody.appendChild(row);
      });

      updatePagination();
    }

    function updatePlateSelect() {
      const plateSelect = document.getElementById("plateSelect");
      plateSelect.innerHTML = "";
      
      data.forEach(item => {
        const option = document.createElement("option");
        option.value = item.plate;
        option.text = item.plate;
        plateSelect.appendChild(option);
      });
    }

    function updatePagination() {
      const totalPages = Math.ceil(data.length / itemsPerPage);
      const paginationText = `${currentPage} من ${totalPages}`;
      document.querySelector(".pagination span").textContent = paginationText;
    }

    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        updateTable();
      }
    }

    function nextPage() {
      const totalPages = Math.ceil(data.length / itemsPerPage);
      if (currentPage < totalPages) {
        currentPage++;
        updateTable();
      }
    }

    function printSelected() {
      if (!loggedIn) {
        alert("يجب تسجيل الدخول أولاً");
        return;
      }

      const selected = Array.from(document.getElementById("plateSelect").selectedOptions).map(opt => opt.value);
      if (selected.length === 0) {
        alert("يرجى اختيار لوحة واحدة على الأقل للطباعة.");
        return;
      }

      const logo = document.getElementById("logoSelect").value;
      const selectedData = data.filter(d => selected.includes(d.plate));
      const now = new Date();
      const printDate = now.toLocaleDateString('ar-EG') + ' ' + now.toLocaleTimeString('ar-EG');

      let html = `
        <div class="print-header">
          <img class="print-logo" src="${logo}" alt="شعار الشركة">
          <h1 class="print-title">طلب صيانة المركبات (تم بالفعل)</h1>
          <div class="print-date">${printDate}</div>
        </div>
        <table class="print-table">
          <thead>
            <tr>
              <th>الخدمة</th>
              <th>رقم اللوحة</th>
              <th>المنطقة</th>
              <th>تاريخ الطلب</th>
              <th>المسافة (كم)</th>
            </tr>
          </thead>
          <tbody>
      `;

      selectedData.forEach(item => {
        html += `
          <tr>
            <td>${item.service}</td>
            <td>${item.plate}</td>
            <td>${item.region}</td>
            <td>${item.date}</td>
            <td>${parseFloat(item.distance).toFixed(2)}</td>
          </tr>
        `;
      });

      html += `
          </tbody>
        </table>
        <div style="margin-top: 20px; text-align: left; font-size: 14px;">
          <p>عدد السجلات المختارة: ${selected.length}</p>
        </div>
      `;

      const printArea = document.getElementById("printArea");
      printArea.innerHTML = html;

      // تأخير الطباعة لضمان تحميل الصورة
      setTimeout(() => {
        window.print();
      }, 300);
    }
  </script>
</body>
</html>
